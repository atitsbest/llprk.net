@model Llprk.Application.DTOs.Requests.EditThemeRequest
@using Newtonsoft.Json.Converters
@using Newtonsoft.Json
@{
    ViewBag.Title = @Model.Name;
}

<style>
    .files {
        margin-left: 10px;
    }

        .files > li {
            margin-top: 5px;
        }

    .fileactions {
        background: #f7f7f7;
        padding: 5px;
    }

    #editor {
    }

        #editor > .CodeMirror {
            height: 600px;
        }

    .nav-tabs > li.active > a, .nav-tabs > li.active > a:hover, .nav-tabs > li.active > a:focus {
        background: #f7f7f7;
    }
</style>

<div class="row">
    <div class="col-xs-2">
        <h3>@Model.Name</h3>
        <div class="row" data-bind="template: { name: 'templateFile', data: { name: 'Layouts', items: layouts } }"></div>
        <div class="row" data-bind="template: { name: 'templateFile', data: { name: 'Assets', items: assets } }"></div>
        <div class="row" data-bind="template: { name: 'templateFile', data: { name: 'Templates', items: templates } }"></div>
        <div class="row" data-bind="template: { name: 'templateFile', data: { name: 'Snippets', items: snippets } }"></div>
    </div>
    <div class="col-xs-10">
        <ul class="nav nav-tabs" role="tablist" data-bind="foreach: openFiles">
            <li role="presentation" data-bind="css: { 'active': $index() === 0 }">
                <a data-bind="attr: { href: '#'+handle }" style="display:inline-block;" aria-controls="home" role="tab" data-toggle="tab">
                    <span data-bind="text:name"></span>
                    <i class="glyphicon glyphicon-remove text-muted" data-bind="click:$parent.closeFileTab.bind($data, $data)"></i>
                </a>
            </li>
        </ul>
        <div class="tab-content" data-bind="foreach: openFiles">
            <div role="tabpanel" class="tab-pane" data-bind="attr: { id: handle },html: content">
            </div>
    </div>
</div>    

<script type="text/template" id="templateFile">
    <i class="glyphicon glyphicon-folder-open"></i>
    <strong data-bind="text:name"></strong>
    <ul class="list-unstyled files" data-bind="foreach: items">
        <li>
            <i data-bind="attr: { 'class': $root.iconFromMimetype($data) }"></i>
            <a data-bind="text:name, click:$root.openFileInTab.bind($data, $data), attr: { href: '#/' + $parent.name + '/' + name }"></a>
        </li>
    </ul>
</script>

@section scripts {
    <script type="text/javascript">
        require(["app/themes/edit"], function (main) {
            main({
                themeName: '@Model.Name',
                itemContentUrl: '@Url.Action(MVC.Admin.Themes.Content())',
                items: @Html.Raw(JsonConvert.SerializeObject(Model, System.Web.Http.GlobalConfiguration.Configuration.Formatters.JsonFormatter.SerializerSettings))
            });
        });
    </script>
}
